## 1. 기본 요구사항 분석
1. 잔액 충전/조회 API
  - 충전 금액이 0보다 작은 값이면 처리가 안되도록 에러를 반환
  - 유효하지않은 유저 ID로 요청한다면 에러를 반환
  - 유저 ID를 통해 잔액 충전 및 조회
  - (추가) 유저의 잔액 변동 기록도 제공 (최근 5번의 잔액 변경 내용 등)
  - 여러 사용자가 동시에 잔액 조회를 하더라도 실시간 데이터가 반영될 수 있도록 처리(트랜젝션 기반 처리나 이벤트 소싱 사용해 데이터 일관성 보장할 예정)
2. 상품 조회 API
  - 조회시점의 상품별 잔여수량을 정확히 조회
  - (추가) 상품 정보 조회 시 재고 수량이나 가격 등 변경되지않는 데이터는 캐시를 통해 성능 최적화를 도모
  - 상품이 판매 중인지의 여부를 명시적으로 반환하기. (판매중인지 품절인지..)
  - (추가) 상품 조회 시 가격, 최신 등록일, 카테고리별, 가격 낮은 순, 가격 높은 순 등으로 필터링 할 수 있는 API 추가
  - (추가) 상품 이름으로 검색할 수 있는 조회 API 추가
  - (추가) 각 추가된 조회 API에 품절상품 제외/포함도 추가
3. 주문/ 결제 API
  - 결제는 MockAPI를 사용하여 "외부 모듈"인 것 처럼 개발
    - 결제 API가 외부 모듈인 것을 가정하여, 타임아웃 처리나 부분 결제 실패 처리 로직 필요할듯
    - 비동기 처리 방식으로 구현
  - 충전 된 잔액을 기반으로 성공할 시에만 잔액을 차감
  - (결제 성공) 결재 성공 후 재고 차감 & 주문 생성의 동시성이 보장되어야 함 (트랜잭션 필요)
  - (결제 실패) 결제가 실패한다면, 이미 차감 된 잔액과 재고를 복구하는 롤백 로직이 필요, 특히 충전 잔액을 복구할 때 다른 API 호출에 영향을 주지 않도록
    - 재시도 
  - (동시성) 다수의 사용자가 동시에 결제요청을 할 수 있으므로 재고 및 잔액 차감에 대한 낙관적 락, 비관적 락을 고려
  - (결제 취소) 결제 이후의 취소 요청에 대한 처리 (환불,잔액 복원,재고 복구, OrderHistory에 기록)
  - 주문 요청이 들어왔지만 이미 다른 사용자가 재고를 소진했을 경우, 주문이 실패해야 함 (최종적으로 재고를 차감할 때 다시 체크)
  - (추가) 하나의 주문에 부분 배송에 대해 상태 업데이트
  - (추가- 주문 취소/수정) 사용자가 진행한 주문건에 대해 취소/수정이 가능하도록 구현
    - 수정시 재고 차감 및 결제 금액 수정
    - 취소시 주문 상태 변경
  - (추가 - 결제 방법에 따른 할인) 본인은 계좌이체로 결제 진행 시 5% 할인해주는 기능을 구현하려 함.
4.선착순 쿠폰 발급 / 유저 보유 쿠폰 조회 API
  - 여러명의 유저가 쿠폰을 발급해도 순차적으로 선착순이 지켜지도록 발급해야 됨
    - 선착순 쿠폰 발급시, 여러 사용자가 동시에 발급시도를 막기위함으로 lock 사용
    - 발급 요청 시 재고를 바로 차감하는 대신, 추후 재고를 나중에 차감(첫 발급(쿠폰 대기 상태 : pending)->실제로 발급되었을 때 재고 차감(발행 상태 : issued)
  - 쿠폰 재고 수량 동시성 문제를 제어하기 위해 lock 사용
  - 쿠폰이 발급되었다면 재고 수량을 차감하고 사용자에게 쿠폰 정보를 반환
  - 쿠폰 수량이 0이거나 선착순이 끝났다면 더 이상 쿠폰을 발급할 수 없다는 response 반환
  - 쿠폰 유효기간과 사용 조건을 임의로 정해야 함 (임의로 발급일로 30일 이내 사용해야하고, 관리자에 의해 취소(상태:revoked)되지 않고 만료되지않은(상태:expired) 쿠폰을 사용해야된다고 정함.)
  - (추가 - 쿠폰 발급) 첫 가입시 기본 쿠폰(구매액의 5% 할인)을 제공
  - (추가 - 자동 쿠폰 만료) 쿠폰 발급 시점으로부터 일정 기간이 지난 후 DB의 쿠폰 상태를 만료로 업데이트 (스케줄링이나 DB 트리거 사용 예정)
5.인기 판매 상품 조회 API
  - 인기 판매 상품 정의
    - 최근 3일간 가장 많이 팔린 상위 5개 상품 정보 제공(기본-판매수량)
    - (추가 - 판매액 기준)최근 3일간 판매액이 가장 많은 상품 정보 제공
    - (추가 - 기간 필터링 조회)최근 3일이 아닌 기간을 동적으로 설정할 수 있게 제공(default 3일)
    - (추가 - 필터링 조건 추가)카테고리 기준 판매수량이 가장 많은 순 조회
  - (추가 - 기간 단위 판매량 통계) 일/주/월 단위 판매 통계 조회 API 추가
6. 이벤트 소싱
   - 모든 상태 변환을 이벤트로 기록하고 (재고 상태, 결제 상태, 주문 상태 등), 이를 통해 상태를 추적하는 방식을 사용할 예정 (각 상태의 업데이트를 기록하고 추후 이벤트 재생을 통해 최종 상태 계산)
## 2. 요구사항에 따른 기획 산출물 
- [시퀀스 다이어그램](https://github.com/everysoon/hhplus-e-commerce/blob/docs/docs/diagram/sequence-diagram.pdf)
- [ERD 다이어그램](https://github.com/everysoon/hhplus-e-commerce/blob/docs/docs/db/erd.png)
- [클래스 다이어그램](https://github.com/everysoon/hhplus-e-commerce/blob/docs/docs/db/class-diagram.png)
- [유즈케이스 다이어그램](https://github.com/everysoon/hhplus-e-commerce/blob/docs/docs/diagram/use-case-diagram.png)


    

